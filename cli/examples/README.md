# Snapshot Showcase

This file showcases snapshot examples generated by the [`term-transcript` CLI app](../cli).
Consult the [generating script](generate-snapshots.sh) for details on preparing the environment.

## Basics

### Static snapshot

![Snapshot of rainbow example](rainbow.svg)

Generating command:

```shell
term-transcript exec --palette gjm8 rainbow
```

(`rainbow` is an executable for [end-to-end tests](../e2e-tests/rainbow).)

### Static snapshot (pure SVG)

![Snapshot of rainbow example](rainbow-pure.svg)

Generating command:

```shell
term-transcript exec --pure-svg --palette gjm8 rainbow
```

### Animated snapshot

![Animated snapshot of rainbow example](animated.svg)

Generating command:

```shell
term-transcript exec --palette powershell --line-height=18px \
   --scroll --pty --window rainbow 'rainbow --long-lines'
```

Note the `--pty` flag to use a pseudo-terminal for capture instead of default pipes,
and an increased line height.

## Configuring console size

### Setting width

![Wide snapshot](rainbow-wide.svg)

Use `--width` to control the pixel width of the console, and `--hard-wrap` to control
at which char the console output is hard-wrapped to a new line. It usually makes sense
to set these both params: `width â‰ˆ hard_wrap * 9` (the exact coefficient depends on
the font being used).

Generating command:

```shell
term-transcript exec --palette gjm8 \
  --hard-wrap=100 --width=900 'rainbow --long-lines'
```

### Setting scroll height

![Small snapshot](rainbow-small.svg)

Use `--scroll=$height` to set the maximum pixel height of the snapshot.

Generating command:

```shell
term-transcript exec --palette gjm8 \
  --hard-wrap=50 --width=450 --scroll=180 rainbow
```

## Line numbering

### Separate numbering for each output

![Separate numbering for outputs](numbers-each-output.svg)

Generating command:

```shell
term-transcript exec --scroll --palette xterm \
  --line-numbers each-output \
  rainbow 'rainbow --short'
```

### Continuous numbering for outputs

![Continuous numbering for outputs](numbers-continuous-outputs.svg)

Generating command:

```shell
term-transcript exec --scroll --palette powershell \
  --line-numbers continuous-outputs \
  --line-height=1.4em \
  rainbow 'rainbow --short'
```

### Continuous numbering for inputs and outputs

![Continuous numbering for inputs and outputs](numbers-continuous.svg)

Generating command:

```shell
term-transcript exec --scroll --palette gjm8 \
  --line-numbers continuous \
  --scroll-interval 2s --scroll-len 2em \
  rainbow 'rainbow --short'
```

Same snapshot generated using the pure SVG template (i.e., with the additional
`--pure-svg` flag):

![Continuous numbering for inputs and outputs](numbers-continuous-pure.svg)

```shell
term-transcript exec --pure-svg --scroll --palette gjm8 \
  --line-numbers continuous \
  --scroll-interval 2s --scroll-len 2em \
  rainbow 'rainbow --short'
```

### Numbering with line breaks

As the example below shows, what is numbered are *displayed* lines
obtained after potential line breaking.

![Numbering with line breaks](numbers-long.svg)

Generating command:

```shell
term-transcript exec --palette gjm8 \
  --line-numbers continuous \
  --line-height 18px \
  'rainbow --long-lines'
```

Same snapshot generated using the pure SVG template (i.e., with the additional
`--pure-svg` flag):

![Numbering with line breaks, pure SVG](numbers-long-pure.svg)

```shell
term-transcript exec --pure-svg --palette gjm8 \
  --line-numbers continuous \
  --line-height 18px \
  --advance-width 7.8px \
  'rainbow --long-lines'
```

## Hiding user inputs

Combined with line numbering and scrolling to test more features.

![Hidden user inputs](no-inputs-numbers.svg)

Generating command:

```shell
term-transcript exec --scroll --palette xterm \
  --no-inputs --line-numbers continuous \
  rainbow 'rainbow --short'
```

Same snapshot generated using the pure SVG template (i.e., with the additional
`--pure-svg` flag):

![Hidden user inputs, pure SVG](no-inputs-numbers-pure.svg)

```shell
term-transcript exec --pure-svg --scroll --palette xterm \
  --no-inputs --line-numbers continuous \
  rainbow 'rainbow --short'
```

## Custom fonts

Using `--styles` and `--font` options, it's possible to use a custom font in the snapshot.
For example, the snapshot below uses [Fira Mono](https://github.com/mozilla/Fira):

![Snapshot with Fira Mono font](fira.svg)

Note that the custom font will only be displayed when viewed in the browser
if the [Content Security Policy][CSP] of the HTTP server hosting the SVG allows to do so.
See the [FAQ](../FAQ.md#transcripts--content-security-policy) for more details.

Generating command:

```shell
term-transcript exec --palette gjm8 --window \
  --font 'Fira Mono, Consolas, Liberation Mono, Menlo' \
  --styles '@import url(https://code.cdn.mozilla.net/fonts/fira.css);' rainbow
```

The same snapshot rendered with pure SVG:

![Snapshot with Fira Mono font and pure SVG](fira-pure.svg)

```shell
term-transcript exec --pure-svg --palette gjm8 --window \
  --font 'Fira Mono, Consolas, Liberation Mono, Menlo' \
  --styles '@import url(https://code.cdn.mozilla.net/fonts/fira.css);' rainbow
```

[CSP]: https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP

### Embedding custom fonts

Using `--embed-font`, it's possible to embed a font into the snapshot (rather than hot-linking it
as with `--font`). The font is *subset* before embedding, meaning that only glyphs for chars
used in the transcripts are retained; this means that the font overhead is not that significant (order of 10 kB).
For example, the snapshot below embeds [Roboto Mono](https://fonts.google.com/specimen/Roboto+Mono):

![Snapshot with embedded Roboto Mono font](embedded-font.svg)

Generating command:

```shell
term-transcript exec --palette gjm8 \
  --line-numbers continuous \
  --embed-font=fonts/RobotoMono.ttf \
  'rainbow --short'
```

The embedded Roboto Mono font is [*variable*][variable-fonts] by font weight, meaning that it has the bold version
(weight: 700) embedded as well. In contrast, the *italic* font face must be synthesized by the browser.
It is possible to embed the italic font face as well by specifying 2 paths for `--embed-font`:

![Snapshot with two embedded Roboto Mono fonts, pure SVG](embedded-font-pure.svg)

```shell
term-transcript exec --palette gjm8 \
  --line-numbers continuous \
  --line-height=1.4em \
  --embed-font="fonts/RobotoMono.ttf:fonts/RobotoMono-Italic.ttf" \
  --pure-svg \
  'rainbow --short'
```

Another example: [Fira Mono](https://fonts.google.com/specimen/Fira+Mono), which is a non-variable font.
We embed its regular and **bold** faces (i.e., *italic* is synthesized):

![Snapshot with embedded Fira Mono fonts, pure SVG](embedded-font-fira.svg)

```shell
term-transcript exec --palette gjm8 \
  --line-numbers continuous \
  --embed-font="fonts/FiraMono-Regular.ttf:fonts/FiraMono-Bold.ttf" \
  --advance-width=8.6px \
  --pure-svg \
  'rainbow --short'
```

The same note regarding [content security policy][CSP] applies.

[variable-fonts]: https://learn.microsoft.com/en-us/typography/opentype/spec/otvaroverview

## Custom template

Using the `--tpl` option, it's possible to use a custom [Handlebars](https://handlebarsjs.com/) template
rather than the standard ones. As an example, [this template](custom.html.handlebars) renders a transcript into HTML.

```shell
term-transcript exec --tpl custom.html.handlebars \
  -o rainbow.html rainbow 'rainbow --short'
```

## Configuration file

`--config-path` option allows reading rendering options from a TOML file. This enables
configuring low-level template details. The snapshot below uses a [configuration file](config.toml)
to customize palette colors and scroll animation step / interval.

![Snapshot with config read from file](custom-config.svg)

Generating command:

```shell
term-transcript exec --config-path config.toml \
  'rainbow --long-lines'
```

## Failed inputs

Some shells may allow detecting whether an input resulted in a failure
(e.g., *nix shells allow doing this by comparing the output of `echo $?` to 0,
while in PowerShell `$?` can be compared to `True`). Such failures are captured
and visually highlighted the default SVG template.

### Failures in `sh`

![Snapshot with failing `sh` commands](failure-sh.svg)

Generating command:

```shell
term-transcript exec --palette gjm8 --window \
  './non-existing-command' \
  '[ -x non-existing-file ]' \
  '[ -x non-existing-file ] || echo "File is not there!"'
```

### Failures in `bash`

Captured using a pseudo-terminal, hence colorful `grep` output.

![Snapshot with failing `grep` in `bash`](failure-bash-pty.svg)

Generating command:

```shell
term-transcript exec --palette gjm8 \
  --pty --window --shell bash \
  --init 'export PS1=' \
  'grep -n serge ../Cargo.toml' \
  'grep -m 5 -n serde ../Cargo.toml'
```

### Failures in `pwsh`

![Snapshot with failing `pwsh` command](failure-pwsh.svg)

```shell
term-transcript exec --window --palette gjm8 \
  --shell pwsh './non-existing-command'
```
